<!DOCTYPE html><html>
<head>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
<script type='text/javascript' language='JavaScript' src='/main.js'></script>
<link rel="stylesheet" href="sys.css">
<style>.thmbn,.rth {width: 60px; text-align:center;}</style>
<title>IBANOHOD ESP12</title>

<style>

.thmbn,.rth {width: 45px; text-align:center;}

.TitleTEXT {
font-family: Impact, Charcoal, sans-serif;
text-shadow: 1px 1px 1px #ff8f00, 3px 3px 1px #ffbf00;
letter-spacing: 7px;
color: #C3231E;
}

.ZON { display: inline-block; border-radius: 100%; border: 3px solid #ccc; }

.rim { font: sans-serif, Impact; color: #C3231E; font-size: 10px; }

@media screen and (max-width: 700px) {
 .SC {font-size:26px;}
 .Zdiv { padding: 20px 0 20px 0; }
 .ZON { font-size: 40px; }
 .TitleIMG { font-size:4function off(){ AJ("/ZAMOK-CLOSE \n play drm"); }0px; }
 .TitleTEXT { font-size: 45px; }
 .ZON { padding: 10px; margin: 15px; }
 .rim { margin-top: 0px; }
 .thmbn,.rth {width: 35px;}
}

@media screen and (min-width: 701px) {
 .SC {font-size:46px;}
 .Zdiv { padding: 60px; }
 .ZON { font-size: 120px; }
 .TitleIMG { font-size:100px; }
 .TitleTEXT { font-size: 90px; }
 .ZON { padding: 20px; margin: 30px; }
 .rim { margin-top:-5px;}
 .thmbn,.rth {width: 45px;}
}

.sc { font-size: 30px; }
.MH,.MV { display:inline-block; } .MH { transform:scale(-1,1); } .MV { transform:scale(1,-1); }
</style>


<script>
function sys_check(){
 var s=f5_read('LastConsole'); if(s) idd('tarea').value=s;
 AJ("echo {ESP_TYPE} {soft}",function(s){ zabil('ESPTYPE',s); });
 askstart();
}

askinterval=false;
function askstart() {
    if(idd('ask').checked) { if(!askinterval) askinterval=setInterval(ask,1000); }
    else { if(askinterval) { clearInterval(askinterval); askinterval=false; } }
}

realsteering=0;

function ask() {
 AJ("echo loop9={LOOP:9}@ENCODER={ENCODER}@rul={rul}@mot={mot}@cmd1={IBAN.cmd1}@cmd2={IBAN.cmd2}@R={IBAN.R}@L={IBAN.L}@bat={IBAN.bat}@temp={IBAN.temp}@led1={IBAN.led1}@led2={IBAN.led2}@steer.calibr={steer.calibr}@steer.mul={steer.mul}@steering={IBAN.steering}",function(s){
    s=s.split('@');
    for(var i of s) {
        var l=i.split('='), n=c(l[0]), l=c(l[1]);

        if(n=='temp' && l!='') l=l/10+'&deg;';

	if(n=='steering') {
	    if(l=='') l=realsteering;
	    else l=1*l+1*idd('vsteer.calibr').value;
	}

	if(n=='loop9') { if(l=='') idd('razgon1').checked=idd('razgon2').checked=false; }

        if(idd(n)) zabil(n,l);
	var e=document.querySelectorAll('.'+n); for(var x of e) x.innerHTML=l;
	if(idd('v'+n) && idd('v'+n).getAttribute('noch')!=1) {
	    idd('v'+n).value=l;
	    noch(idd('v'+n),0,n);
	}
	// if(idd('c'+n)) idd('c'+n).checked=(1*l?true:false);
    }
 });
}


function D(v) { AJ(v,function(s){ if(s!='') salert(s,500) }); }
function cD(e) { D(e.id.replace(/^c/g,'')+' = '+(e.checked?1:0)); }
function Dconf(n,v) { D('set '+n+' = '+v+' ; FILE.key.add Settings.txt '+n+' '+v); }

function noch(e,x,l) {
    e.setAttribute('noch',x);
    var w=e.closest('DIV').querySelector('SPAN');
    if(w) w.innerHTML=e.value;
}
</script>

</head><body onload="sys_check()">

<i class='logout e_mob-ball' onclick="logout()"></i>
<i class='logo'></i>

<p style='font-size:32px;color:#C3231E;' id='ESPTYPE'>ESP</p>

<div style='font-size:3px;eeewidth:600px;' class="thmbns us">
<ins class="thmbn"><div class="rth"><span class='sc'>&#128225;</span><div class='rim'>
<div id='cmd1'>Cmd1</div>
<div id='rul'></div>
</div></div></ins>
<ins class="thmbn"><div class="rth"><span class='sc'>&#128752;</span><div class='rim'>
<div id='cmd2'>Cmd2</div>
<div id='mot'></div>
</div></div></ins>
<ins class="thmbn"><div class="rth"><span class='sc MH'>&#128663;</span><div class='rim' id='R'>Speed R</div></div></ins>
<ins class="thmbn"><div class="rth"><span class='sc'>&#128663;</span><div class='rim' id='L'>Speed L</div></div></ins>
<ins class="thmbn"><div class="rth"><span class='sc'>&#128267;</span><div class='rim' id='bat'>Bat</div></div></ins>
<ins class="thmbn"><div class="rth"><span class='sc'>&#127777;</span><div class='rim' id='temp'>Temp</div></div></ins>
<ins class="thmbn"><div class="rth"><span class='sc'>&#128161;</span><div class='rim' id='led2'>Led2</div></div></ins>
<ins class="thmbn"><div class="rth"><span class='sc'>&#127982;</span><div class='rim' id='led1'>Led1</div></div></ins>
<ins class="thmbn"><div class="rth"><span class='sc'>&#128640;</span><div class='rim' id='steering'>Handle</div></div></ins>
</div>


<div style="margin:20px"><center>

<input style='padding:20px;' onclick="D('STOP')" type='button' value='СТОП'>

<table class='us' border=0 cellpadding=15><tr align='center'>
<td>
<label class="switch"><input id='razgon1' onchange="if(this.checked) D('GON')" type="checkbox"><span class="slider round"></span></label>
<div class=br>разгон<br>влево</div>
</td><td>
<label class="switch"><input id='cled1' onchange='cD(this)' type="checkbox"><span class="slider round"></span></label>
<div class=br>ФАРЫ</div>
</td><td>
<label class="switch"><input id='cled2' onchange='cD(this)' type="checkbox"><span class="slider round"></span></label>
<div class=br>РЕМЕНЬ</div>
</td><td>
<label class="switch"><input id='razgon2' onchange="if(this.checked) D('BACK')" type="checkbox"><span class="slider round"></span></label>
<div class=br>разгон<br>вправо</div>
</td>
</tr></table>

</center>


<div>
<p>скорость: <span></span>
<br><input oninput="noch(this,1);" type="range" id="vmot" min="-200" max="200" style="width:500px;" onchange="noch(this,0); D('mot = '+this.value)">
</div>

<div>
<p>руль: <span></span>
<br><input oninput="noch(this,1);" type="range" id="vrul" min="-1000" max="1000" style="width:500px;" onchange="noch(this,0); D('rul = '+this.value)">
</div>

<div class=br>рычаги управления</div>

<div>
<p>hardware Handle: <select onchange="Dconf('hhandle',this.value)">
<option value="devnull">---</option>
<option value="mot">газ</option>
<option value="rul">руль</option>
</select> &nbsp; <span></span>
<br><input oninput="noch(this,1);" type="range" id="vsteering" min="-1000" max="1000" style="width:500px;" onchange="noch(this,0); realsteering=this.value">
</div>

<div>
<p>hardware Encoder: <select onchange="Dconf('hencoder',this.value)">
<option value="devnull">---</option>
<option value="mot">газ</option>
<option value="rul">руль</option>
</select> &nbsp; <span></span>
<br><input oninput="noch(this,1);" type="range" id="vENCODER" min="-100" max="100" style="width:500px;" onchange="noch(this,0); D('ENCODER = '+this.value)">
</div>

<div class='vcenter'>Посылать запросы: &nbsp; &nbsp; <label class="switch"><input id='ask' onchange="askstart()" type="checkbox" checked="false"><span class="slider round"></span></label></div>

<div><b>Поправка руля:</b> <input style="width:auto" id='vsteer.calibr' size="4" class='tat' placeholder="-20" onchange="Dconf('steer.calibr',this.value)"></div>
<div><b>Множитель руля:</b> <input style="width:auto" id='vsteer.mul' size="4" class='tat' placeholder="1" onchange="Dconf('steer.mul',this.value)"></div>

<!--
<input style="width:auto" size="16" id="UdpAddr" class='tat' placeholder="10.0.0.200"> <b>:</b>
<input style="width:auto" size="4" id="UdpPort" class='tat' placeholder="8888">
<input style="width:auto" type="button" value="Set" onclick="udp_set()" class='tat mv0'>
</div>
-->


<center><div class='divta'>
<span class='ri'><span class='mv' onclick="execute(this.closest('DIV').querySelector('TEXTAREA').value)">DO</span></span>
<textarea rows=5 class='tat' id='tarea' onchange="f5_save('LastConsole',this.value)"></textarea>
</div></center>

<div style='margin-top:20px;eeewidth:600px;' class="thmbns us">
<ins class="thmbn mv0"><div class="rth" alt='/info' onclick='aFlash(this);go(this)'><span class='SC'>&#129518;</span><p class='rim'>Info</div></ins>
<ins class="thmbn mv0"><div class="rth" onclick='aFlash(this);ESPrestart()'><span class='SC'>&#128244;</span><p class='rim'>Reboot</div></ins>
<ins class="thmbn mv0"><div class="rth" onclick='aFlash(this);wifiscan()'><span class='SC'>&#128246;</span></i><p class='rim'>WiFi</div></ins>
<ins class="thmbn mv0"><div class="rth" onclick="getsofts()"><div id='upgrade_id' class='SC in'>&#128693;</div><p class='rim'>Update</p><div class='br' id='firmware'></div></div></ins>
<ins class="thmbn mv0"><div class="rth" alt='/test.htm' onclick='aFlash(this);go(this)'><span class='SC'>&#127981;</span><p class='rim'>GPIO</div></ins>
<ins class="thmbn mv0"><div class="rth" alt='/a0m.htm' onclick='aFlash(this);go(this)'><span class='SC'>&#127748;</span><p class='rim'>Monitor</div></ins>
<ins class="thmbn mv0"><div class="rth" onclick='FM_fileman()'><span class='SC'>&#128190;</span><p class='rim'>Files</div></ins>
</div>

</div>

<div class='br' id='firmware' style='text-align:left;display:inline-block;'></div>

<p class='br'><a href='https://lleo.me/ESP8266/cfaq' target='_blank'>Help</a>

</body></html>